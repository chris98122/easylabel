{% extends 'base.html' %}


{% block scripts %}
{{ super() }}
<script src="/static/jquery-3.2.1.js" type="text/javascript"></script>	
<script src="/static/jquery.selectareas.js" type="text/javascript"></script>


<script type="text/javascript">
    $(document).ready(function () {
        var istagged=false;
        $('img#example').selectAreas({
            minSize: [10, 10],
            onChanged: debugQtyAreas,
            width: 640,
            height: 480,
            //需要特别写一下图片像素大小不然标注的x,y width,height都会有错
            areas: [
                {
                    x: 10,
                    y: 20,
                    width: 60,
                    height: 100
                }
            ]
        });
        $('#btnView').click(function () {
            var areas = $('img#example').selectAreas('areas');
            displayAreas(areas);
        });
        $('#btnViewRel').click(function () {
            var areas = $('img#example').selectAreas('relativeAreas');
            displayAreas(areas);
        });
        //relativeAreas () : returns an array of areas, with their size and 
        //coordinates on the original image (see option width). Equal to areas() 
        //when the image is displayed in full size.
        $('#btnReset').click(function () {
            output("reset")
            $('img#example').selectAreas('reset');
        });
       
        $('#btnNew').click(function () {
            var areaOptions = {
                x: Math.floor((Math.random() * 200)),
                y: Math.floor((Math.random() * 200)),
                width: Math.floor((Math.random() * 100)) + 50,
                height: Math.floor((Math.random() * 100)) + 20,
            };
            output("Add a new area: " + areaToString(areaOptions))
            $('img#example').selectAreas('add', areaOptions);
        });

        $('#submit').click(function () {
            var areas = $('img#example').selectAreas('areas');
            var label=document.getElementById("tag_input").value;
            output(label);
            output("labelled " + areaToString(areaOptions))
            $('img#example').selectAreas('add', areaOptions);
        });
        

    });
    var selectionExists;
    function areaToString (area) {
        return (typeof area.id === "undefined" ? "" : (area.id + ": ")) + area.x + ':' + area.y  + ' ' + area.width + 'x' + area.height +'<br />'
    }
    function output (text) {
        $('#output').html(text);
    }
    // Log the quantity of selections
    function debugQtyAreas (event, id, areas) {
        console.log(areas.length + " areas", arguments);
    };
    // Display areas coordinates in a div
    function displayAreas (areas) {
        var text = "";
        $.each(areas, function (id, area) {
            text += areaToString(area);
        });
        output(text);
    };
</script>
</head>

<body>
<div id="wrapper">
    <h1>Demo Select Areas</h1>

   
        <img class="img-responsive" alt="Image principale" id="example" src={{file}}/>
   
    <a class="action"  href="{{ url_for('label.annotation', id=id+1) }}">下一张图片</a>
    <table>
        <tr>
            <td class="actions">
                <input type="text" id="tag_input" name="tag_input">
                <input type="button" id="submit" value="submit">
                <input type="button" id="btnView" value="Display areas" class="actionOn" />
                <input type="button" id="btnViewRel" value="Display relative" class="actionOn" />
                <input type="button" id="btnReset" value="Reset" class="actionOn" />
            
            </td>
            <td>
                <div id="output" class='output'> </div>
            </td>
        </tr>
    </table>

</div>
</body>

{% endblock %}